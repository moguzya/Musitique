<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
<ui:composition>
    <div align="center">
        <h:form>
            <c:if test="#{userController.isLoggedIn() == true}">
                <p:rating value="#{entityController.getUserRating().rating}">
                    <p:ajax event="rate" listener="#{entityController.onRate}"/>
                    <p:ajax event="cancel" listener="#{entityController.onUnrate}"/>
                </p:rating>
            </c:if>
            <h:outputText value="Comments"/>
            <p:dataTable
                    id="commentsTable"
                    var="aComment"
                    value="#{entityController.getListOfComments()}"
                    selection="#{entityController.selectedComment}">
                <p:column rendered="#{(userController.isLoggedIn() == true) and (userController.isOwner(aComment))}">
                    <p:commandButton icon="pi pi-times"
                                     styleClass="rounded-button ui-button-danger"
                                     action="#{entityController.destroyComment(aComment)}"
                                     ajax="false"
                                     update="commentsTable,:growlInfoMessage,:growlWarningMessage,:growlErrorMessage,:growlFatalMessage">
                    </p:commandButton>
                </p:column>

                <p:column>
                    <h:outputText value="#{aComment.userId.getUsername()}: #{aComment.comment}"/>
                </p:column>

                <p:column>
                    <h:outputText value="#{aComment.date}"/>
                </p:column>
            </p:dataTable>
            <c:if test="#{userController.isLoggedIn() == true}">
                <p:inputTextarea rows="5" value="#{entityController.newCommentText}" counter="display" maxlength="256"
                                 counterTemplate="{0} characters remaining."/>
                <h:outputText id="display" class="p-d-block"/>
                <p:commandButton value="Post Comment" icon="fas fa-save" styleClass="rounded-button"
                                 ajax="false" actionListener="#{entityController.postComment}"
                                 update=":commentsTable,:growlInfoMessage,:growlWarningMessage,:growlErrorMessage,:growlFatalMessage"
                                 oncomplete="#{entityController.postComment}"/>
            </c:if>
        </h:form>
    </div>

</ui:composition>
<!-- Do not enter tags before the composition line since they are ignored by JSF -->

</html>
